From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Spottedleaf <spottedleaf@spottedleaf.dev>
Date: Tue, 9 Jun 2020 00:45:01 -0700
Subject: [PATCH] Prevent getChunkAtAsync calls in an unload event from firing
 a load event


diff --git a/src/main/java/net/minecraft/server/ChunkProviderServer.java b/src/main/java/net/minecraft/server/ChunkProviderServer.java
index 13bb9a630c648d5844fb13a372fa2464d1b30718..be23acee2aa518b14a10a6939fad3eb2b6925418 100644
--- a/src/main/java/net/minecraft/server/ChunkProviderServer.java
+++ b/src/main/java/net/minecraft/server/ChunkProviderServer.java
@@ -708,7 +708,7 @@ public class ChunkProviderServer extends IChunkProvider {
             PlayerChunk.State currentChunkState = PlayerChunk.getChunkState(playerchunk.getTicketLevel());
             currentlyUnloading = (oldChunkState.isAtLeast(PlayerChunk.State.BORDER) && !currentChunkState.isAtLeast(PlayerChunk.State.BORDER));
         }
-        if (flag) { // Paper - don't care about unloading state
+        if (flag && !currentlyUnloading) { // Paper - don't care about unloading state // Tuinity - prevent firing chunk load events while in chunk unload events
             // CraftBukkit end
             this.chunkMapDistance.a(TicketType.UNKNOWN, chunkcoordintpair, l, chunkcoordintpair);
             if (isUrgent) this.chunkMapDistance.markUrgent(chunkcoordintpair); // Paper
